"use strict";

require("core-js/modules/es.array.iterator");

require("core-js/modules/es.promise");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.waitUntilElementFound = waitUntilElementFound;
exports.waitUntilElementDisappear = waitUntilElementDisappear;
exports.waitUntilIframeFound = waitUntilIframeFound;
exports.fillInput = fillInput;
exports.clickButton = clickButton;
exports.clickLink = clickLink;
exports.dropdownSelect = dropdownSelect;
exports.dropdownElements = dropdownElements;
exports.pageEval = pageEval;
exports.pageEvalAll = pageEvalAll;
exports.elementPresentOnPage = elementPresentOnPage;
exports.setValue = setValue;

var _waiting = require("./waiting");

async function waitUntilElementFound(page, elementSelector, onlyVisible = false, timeout) {
  await page.waitForSelector(elementSelector, {
    visible: onlyVisible,
    timeout
  });
}

async function waitUntilElementDisappear(page, elementSelector, timeout) {
  await page.waitForSelector(elementSelector, {
    hidden: true,
    timeout
  });
}

async function waitUntilIframeFound(page, framePredicate, description = '', timeout = 30000) {
  let frame;
  await (0, _waiting.waitUntil)(() => {
    frame = page.frames().find(framePredicate);
    return Promise.resolve(!!frame);
  }, description, timeout, 1000);

  if (!frame) {
    throw new Error('failed to find iframe');
  }

  return frame;
}

async function fillInput(pageOrFrame, inputSelector, inputValue) {
  await pageOrFrame.$eval(inputSelector, input => {
    const inputElement = input; // @ts-ignore

    inputElement.value = '';
  });
  await pageOrFrame.type(inputSelector, inputValue);
}

async function setValue(pageOrFrame, inputSelector, inputValue) {
  await pageOrFrame.$eval(inputSelector, (input, inputValue) => {
    const inputElement = input; // @ts-ignore

    inputElement.value = inputValue;
  }, [inputValue]);
}

async function clickButton(page, buttonSelector) {
  await page.$eval(buttonSelector, el => el.click());
}

async function clickLink(page, aSelector) {
  await page.$eval(aSelector, el => {
    if (!el || typeof el.click === 'undefined') {
      return;
    }

    el.click();
  });
}

async function pageEvalAll(page, selector, defaultResult, callback, ...args) {
  let result = defaultResult;

  try {
    result = await page.$$eval(selector, callback, ...args);
  } catch (e) {
    // TODO temporary workaround to puppeteer@1.5.0 which breaks $$eval bevahvior until they will release a new version.
    if (e.message.indexOf('Error: failed to find elements matching selector') !== 0) {
      throw e;
    }
  }

  return result;
}

async function pageEval(pageOrFrame, selector, defaultResult, callback, ...args) {
  let result = defaultResult;

  try {
    result = await pageOrFrame.$eval(selector, callback, ...args);
  } catch (e) {
    // TODO temporary workaround to puppeteer@1.5.0 which breaks $$eval bevahvior until they will release a new version.
    if (e.message.indexOf('Error: failed to find element matching selector') !== 0) {
      throw e;
    }
  }

  return result;
}

async function elementPresentOnPage(pageOrFrame, selector) {
  return (await pageOrFrame.$(selector)) !== null;
}

async function dropdownSelect(page, selectSelector, value) {
  await page.select(selectSelector, value);
}

async function dropdownElements(page, selector) {
  const options = await page.evaluate(optionSelector => {
    return Array.from(document.querySelectorAll(optionSelector)).filter(o => o.value).map(o => {
      return {
        name: o.text,
        value: o.value
      };
    });
  }, `${selector} > option`);
  return options;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oZWxwZXJzL2VsZW1lbnRzLWludGVyYWN0aW9ucy50cyJdLCJuYW1lcyI6WyJ3YWl0VW50aWxFbGVtZW50Rm91bmQiLCJwYWdlIiwiZWxlbWVudFNlbGVjdG9yIiwib25seVZpc2libGUiLCJ0aW1lb3V0Iiwid2FpdEZvclNlbGVjdG9yIiwidmlzaWJsZSIsIndhaXRVbnRpbEVsZW1lbnREaXNhcHBlYXIiLCJoaWRkZW4iLCJ3YWl0VW50aWxJZnJhbWVGb3VuZCIsImZyYW1lUHJlZGljYXRlIiwiZGVzY3JpcHRpb24iLCJmcmFtZSIsImZyYW1lcyIsImZpbmQiLCJQcm9taXNlIiwicmVzb2x2ZSIsIkVycm9yIiwiZmlsbElucHV0IiwicGFnZU9yRnJhbWUiLCJpbnB1dFNlbGVjdG9yIiwiaW5wdXRWYWx1ZSIsIiRldmFsIiwiaW5wdXQiLCJpbnB1dEVsZW1lbnQiLCJ2YWx1ZSIsInR5cGUiLCJzZXRWYWx1ZSIsImNsaWNrQnV0dG9uIiwiYnV0dG9uU2VsZWN0b3IiLCJlbCIsImNsaWNrIiwiY2xpY2tMaW5rIiwiYVNlbGVjdG9yIiwicGFnZUV2YWxBbGwiLCJzZWxlY3RvciIsImRlZmF1bHRSZXN1bHQiLCJjYWxsYmFjayIsImFyZ3MiLCJyZXN1bHQiLCIkJGV2YWwiLCJlIiwibWVzc2FnZSIsImluZGV4T2YiLCJwYWdlRXZhbCIsImVsZW1lbnRQcmVzZW50T25QYWdlIiwiJCIsImRyb3Bkb3duU2VsZWN0Iiwic2VsZWN0U2VsZWN0b3IiLCJzZWxlY3QiLCJkcm9wZG93bkVsZW1lbnRzIiwib3B0aW9ucyIsImV2YWx1YXRlIiwib3B0aW9uU2VsZWN0b3IiLCJBcnJheSIsImZyb20iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmaWx0ZXIiLCJvIiwibWFwIiwibmFtZSIsInRleHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTs7QUFFQSxlQUFlQSxxQkFBZixDQUFxQ0MsSUFBckMsRUFBeURDLGVB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NUMsRUFBOEQ7QUFDNUQsUUFBTWdCLE9BQU8sR0FBRyxNQUFNbEQsSUFBSSxDQUFDbUQsUUFBTCxDQUFlQyxjQUFELElBQW9CO0FBQ3RELFdBQU9DLEtBQUssQ0FBQ0MsSUFBTixDQUFXQyxRQUFRLENBQUNDLGdCQUFULENBQTBCSixjQUExQixDQUFYLEVBQ0pLLE1BREksQ0FDSUMsQ0FBRCxJQUFPQSxDQUFDLENBQUNsQyxLQURaLEVBRUptQyxHQUZJLENBRUNELENBQUQsSUFBTztBQUNWLGFBQU87QUFDTEUsUUFBQUEsSUFBSSxFQUFFRixDQUFDLENBQUNHLElBREg7QUFFTHJDLFFBQUFBLEtBQUssRUFBRWtDLENBQUMsQ0FBQ2xDO0FBRkosT0FBUDtBQUlELEtBUEksQ0FBUDtBQVFELEdBVHFCLEVBU2xCLEdBQUVVLFFBQVMsV0FUTyxDQUF0QjtBQVVBLFNBQU9nQixPQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGcmFtZSwgUGFnZSB9IGZyb20gJ3B1cHBldGVlcic7XG5pbXBvcnQgeyB3YWl0VW50aWwgfSBmcm9tICcuL3dhaXRpbmcnO1xuXG5hc3luYyBmdW5jdGlvbiB3YWl0VW50aWxFbGVtZW50Rm91bmQocGFnZTogUGFnZSB8IEZyYW1lLCBlbGVtZW50U2VsZWN0b3I6IHN0cmluZyxcbiAgb25seVZpc2libGUgPSBmYWxzZSwgdGltZW91dD86IG51bWJlcikge1xuICBhd2FpdCBwYWdlLndhaXRGb3JTZWxlY3RvcihlbGVtZW50U2VsZWN0b3IsIHsgdmlzaWJsZTogb25seVZpc2libGUsIHRpbWVvdXQgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHdhaXRVbnRpbEVsZW1lbnREaXNhcHBlYXIocGFnZTogUGFnZSwgZWxlbWVudFNlbGVjdG9yOiBzdHJpbmcsIHRpbWVvdXQ/OiBudW1iZXIpIHtcbiAgYXdhaXQgcGFnZS53YWl0Rm9yU2VsZWN0b3IoZWxlbWVudFNlbGVjdG9yLCB7IGhpZGRlbjogdHJ1ZSwgdGltZW91dCB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gd2FpdFVudGlsSWZyYW1lRm91bmQocGFnZTogUGFnZSwgZnJhbWVQcmVkaWNhdGU6IChmcmFtZTogRnJhbWUpID0+IGJvb2xlYW4sIGRlc2NyaXB0aW9uID0gJycsIHRpbWVvdXQgPSAzMDAwMCkge1xuICBsZXQgZnJhbWU6IEZyYW1lIHwgdW5kZWZpbmVkO1xuICBhd2FpdCB3YWl0VW50aWwoKCkgPT4ge1xuICAgIGZyYW1lID0gcGFnZVxuICAgICAgLmZyYW1lcygpXG4gICAgICAuZmluZChmcmFtZVByZWRpY2F0ZSk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSghIWZyYW1lKTtcbiAgfSwgZGVzY3JpcHRpb24sIHRpbWVvdXQsIDEwMDApO1xuXG4gIGlmICghZnJhbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2ZhaWxlZCB0byBmaW5kIGlmcmFtZScpO1xuICB9XG5cbiAgcmV0dXJuIGZyYW1lO1xufVxuXG5hc3luYyBmdW5jdGlvbiBmaWxsSW5wdXQocGFnZU9yRnJhbWU6IFBhZ2UgfCBGcmFtZSwgaW5wdXRTZWxlY3Rvcjogc3RyaW5nLCBpbnB1dFZhbHVlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgYXdhaXQgcGFnZU9yRnJhbWUuJGV2YWwoaW5wdXRTZWxlY3RvciwgKGlucHV0OiBFbGVtZW50KSA9PiB7XG4gICAgY29uc3QgaW5wdXRFbGVtZW50ID0gaW5wdXQ7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGlucHV0RWxlbWVudC52YWx1ZSA9ICcnO1xuICB9KTtcbiAgYXdhaXQgcGFnZU9yRnJhbWUudHlwZShpbnB1dFNlbGVjdG9yLCBpbnB1dFZhbHVlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0VmFsdWUocGFnZU9yRnJhbWU6IFBhZ2UgfCBGcmFtZSwgaW5wdXRTZWxlY3Rvcjogc3RyaW5nLCBpbnB1dFZhbHVlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgYXdhaXQgcGFnZU9yRnJhbWUuJGV2YWwoaW5wdXRTZWxlY3RvciwgKGlucHV0OiBFbGVtZW50LCBpbnB1dFZhbHVlKSA9PiB7XG4gICAgY29uc3QgaW5wdXRFbGVtZW50ID0gaW5wdXQ7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGlucHV0RWxlbWVudC52YWx1ZSA9IGlucHV0VmFsdWU7XG4gIH0sIFtpbnB1dFZhbHVlXSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsaWNrQnV0dG9uKHBhZ2U6IFBhZ2UgfCBGcmFtZSwgYnV0dG9uU2VsZWN0b3I6IHN0cmluZykge1xuICBhd2FpdCBwYWdlLiRldmFsKGJ1dHRvblNlbGVjdG9yLCAoZWwpID0+IChlbCBhcyBIVE1MRWxlbWVudCkuY2xpY2soKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsaWNrTGluayhwYWdlOiBQYWdlLCBhU2VsZWN0b3I6IHN0cmluZykge1xuICBhd2FpdCBwYWdlLiRldmFsKGFTZWxlY3RvciwgKGVsOiBhbnkpID0+IHtcbiAgICBpZiAoIWVsIHx8IHR5cGVvZiBlbC5jbGljayA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlbC5jbGljaygpO1xuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcGFnZUV2YWxBbGw8Uj4ocGFnZTogUGFnZSB8IEZyYW1lLCBzZWxlY3Rvcjogc3RyaW5nLFxuICBkZWZhdWx0UmVzdWx0OiBhbnksIGNhbGxiYWNrOiAoZWxlbWVudHM6IEVsZW1lbnRbXSwgLi4uYXJnczogYW55KSA9PiBSLCAuLi5hcmdzOiBhbnlbXSk6IFByb21pc2U8Uj4ge1xuICBsZXQgcmVzdWx0ID0gZGVmYXVsdFJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBhd2FpdCBwYWdlLiQkZXZhbChzZWxlY3RvciwgY2FsbGJhY2ssIC4uLmFyZ3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gVE9ETyB0ZW1wb3Jhcnkgd29ya2Fyb3VuZCB0byBwdXBwZXRlZXJAMS41LjAgd2hpY2ggYnJlYWtzICQkZXZhbCBiZXZhaHZpb3IgdW50aWwgdGhleSB3aWxsIHJlbGVhc2UgYSBuZXcgdmVyc2lvbi5cbiAgICBpZiAoZS5tZXNzYWdlLmluZGV4T2YoJ0Vycm9yOiBmYWlsZWQgdG8gZmluZCBlbGVtZW50cyBtYXRjaGluZyBzZWxlY3RvcicpICE9PSAwKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHBhZ2VFdmFsPFI+KHBhZ2VPckZyYW1lOiBQYWdlIHwgRnJhbWUsIHNlbGVjdG9yOiBzdHJpbmcsXG4gIGRlZmF1bHRSZXN1bHQ6IGFueSwgY2FsbGJhY2s6IChlbGVtZW50czogRWxlbWVudCwgLi4uYXJnczogYW55KSA9PiBSLCAuLi5hcmdzOiBhbnlbXSk6IFByb21pc2U8Uj4ge1xuICBsZXQgcmVzdWx0ID0gZGVmYXVsdFJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBhd2FpdCBwYWdlT3JGcmFtZS4kZXZhbChzZWxlY3RvciwgY2FsbGJhY2ssIC4uLmFyZ3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gVE9ETyB0ZW1wb3Jhcnkgd29ya2Fyb3VuZCB0byBwdXBwZXRlZXJAMS41LjAgd2hpY2ggYnJlYWtzICQkZXZhbCBiZXZhaHZpb3IgdW50aWwgdGhleSB3aWxsIHJlbGVhc2UgYSBuZXcgdmVyc2lvbi5cbiAgICBpZiAoZS5tZXNzYWdlLmluZGV4T2YoJ0Vycm9yOiBmYWlsZWQgdG8gZmluZCBlbGVtZW50IG1hdGNoaW5nIHNlbGVjdG9yJykgIT09IDApIHtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZWxlbWVudFByZXNlbnRPblBhZ2UocGFnZU9yRnJhbWU6IFBhZ2UgfCBGcmFtZSwgc2VsZWN0b3I6IHN0cmluZykge1xuICByZXR1cm4gYXdhaXQgcGFnZU9yRnJhbWUuJChzZWxlY3RvcikgIT09IG51bGw7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRyb3Bkb3duU2VsZWN0KHBhZ2U6IFBhZ2UsIHNlbGVjdFNlbGVjdG9yOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgYXdhaXQgcGFnZS5zZWxlY3Qoc2VsZWN0U2VsZWN0b3IsIHZhbHVlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZHJvcGRvd25FbGVtZW50cyhwYWdlOiBQYWdlLCBzZWxlY3Rvcjogc3RyaW5nKSB7XG4gIGNvbnN0IG9wdGlvbnMgPSBhd2FpdCBwYWdlLmV2YWx1YXRlKChvcHRpb25TZWxlY3RvcikgPT4ge1xuICAgIHJldHVybiBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwob3B0aW9uU2VsZWN0b3IpKVxuICAgICAgLmZpbHRlcigobykgPT4gby52YWx1ZSlcbiAgICAgIC5tYXAoKG8pID0+IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBuYW1lOiBvLnRleHQsXG4gICAgICAgICAgdmFsdWU6IG8udmFsdWUsXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgfSwgYCR7c2VsZWN0b3J9ID4gb3B0aW9uYCk7XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5leHBvcnQge1xuICB3YWl0VW50aWxFbGVtZW50Rm91bmQsXG4gIHdhaXRVbnRpbEVsZW1lbnREaXNhcHBlYXIsXG4gIHdhaXRVbnRpbElmcmFtZUZvdW5kLFxuICBmaWxsSW5wdXQsXG4gIGNsaWNrQnV0dG9uLFxuICBjbGlja0xpbmssXG4gIGRyb3Bkb3duU2VsZWN0LFxuICBkcm9wZG93bkVsZW1lbnRzLFxuICBwYWdlRXZhbCxcbiAgcGFnZUV2YWxBbGwsXG4gIGVsZW1lbnRQcmVzZW50T25QYWdlLFxuICBzZXRWYWx1ZSxcbn07XG4iXX0=